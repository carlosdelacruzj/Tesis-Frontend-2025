<div class="container-fluid dashboard-content">
  <div class="container-fluid">
    <div><h1>Pedidos</h1></div>

    <div class="row">
      <div class="col-8">
        <mat-form-field appearance="fill">
          <input matInput placeholder="Buscar" autocomplete="off" (keyup)="filterData($event)">
        </mat-form-field>
      </div>
      <div class="col-4">
        <div style="text-align:right">
          <button class="btn btn-primary btn-lg" [routerLink]="['/home/gestionar-pedido/agregar']">
            Registrar pedido
          </button>
        </div>
      </div>
    </div>

    <!-- LISTA DE PEDIDOS -->
    <table mat-table [dataSource]="dataSource" matSort class="table">

      <!-- ID -->
      <ng-container matColumnDef="ID">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
        <td mat-cell *matCellDef="let element"> {{ element.ID }} </td>
      </ng-container>

      <!-- Cliente -->
      <ng-container matColumnDef="Cliente">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Cliente </th>
        <td mat-cell *matCellDef="let element">
          {{ element.Cliente }}
          <small class="text-muted" *ngIf="element.Documento"> — {{ element.Documento }}</small>
        </td>
      </ng-container>

      <!-- Creado -->
      <ng-container matColumnDef="Creado">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Creado </th>
        <td mat-cell *matCellDef="let element">
          {{ element.Creado | date:'dd-MM-yyyy' }}
        </td>
      </ng-container>

      <!-- ProxFecha -->
      <ng-container matColumnDef="ProxFecha">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Próx. fecha </th>
        <td mat-cell *matCellDef="let element">
          <ng-container *ngIf="element.ProxFecha; else dash">
            {{ element.ProxFecha | date:'dd-MM-yyyy' }}
            <small class="text-muted" *ngIf="element.ProxDia"> ({{ element.ProxDia }})</small>
          </ng-container>
          <ng-template #dash>—</ng-template>
        </td>
      </ng-container>

      <!-- ProxHora -->
      <ng-container matColumnDef="ProxHora">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Próx. hora </th>
        <td mat-cell *matCellDef="let element">
          {{ (element.ProxHora || '') | slice:0:5 }} <!-- HH:mm -->
        </td>
      </ng-container>

      <!-- Ubicacion -->
      <ng-container matColumnDef="Ubicacion">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Ubicación </th>
        <td mat-cell *matCellDef="let element"> {{ element.Ubicacion || '—' }} </td>
      </ng-container>

      <!-- TipoEvento -->
      <ng-container matColumnDef="TipoEvento">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo </th>
        <td mat-cell *matCellDef="let element"> {{ element.TipoEvento || '—' }} </td>
      </ng-container>

      <!-- Total (usa TotalLabel del SP) -->
      <ng-container matColumnDef="Total">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Total </th>
        <td mat-cell *matCellDef="let element">
          {{ element.TotalLabel || '—' }}
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="Estado">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Estado </th>
        <td mat-cell *matCellDef="let element"> {{ element.Estado }} </td>
      </ng-container>

      <!-- Pago -->
      <ng-container matColumnDef="Pago">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Pago </th>
        <td mat-cell *matCellDef="let element"> {{ element.Pago }} </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="Visualizar">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let element">
          <button mat-button style="background-color:transparent"
                  [routerLink]="['/home/gestionar-pedido/actualizar', element.ID]">
            <i class="fas fa-edit fa-2x"></i>
          </button>
          <button mat-button style="background-color:transparent"
                  [routerLink]="['/home/gestionar-pedido/detalle', element.ID]">
            <i class="fas fa-eye fa-2x"></i>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"></tr>
    </table>

    <div class="text-center text-muted" *ngIf="dataSource && dataSource.data?.length === 0">
      Sin resultados
    </div>

    <mat-paginator #paginator [pageSize]="25" [pageSizeOptions]="[10, 25, 100]"></mat-paginator>
  </div>
</div>
