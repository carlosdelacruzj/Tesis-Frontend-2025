<div class="dashboard-content">
  <app-list-toolbar
    [title]="'Inventario de equipos'"
    [description]="'Explora rápidamente los modelos disponibles agrupados por tipo y accede al detalle completo.'"
    [showSearch]="true"
    [searchPlaceholder]="'Tipo, marca o modelo'"
    [searchValue]="busqueda"
    [showCreateButton]="true"
    [createButtonLabel]="'Nuevo tipo'"
    [disableCreate]="formTipo.cargando"
    (searchChange)="onBuscar($event)"
    (createClick)="abrirModalTipo()"
  >
  </app-list-toolbar>

  <!-- <div class="filtros-secundarios">
    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Categoría</mat-label>
      <mat-select [value]="categoriaSeleccionada" (selectionChange)="onSeleccionarCategoria($event.value)">
        <mat-option value="todas">Todas las categorías</mat-option>
        <mat-option *ngFor="let categoria of categoriasDisponibles" [value]="categoria">
          {{ categoria }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div> -->

  <ng-container *ngIf="filtradoResumen.length; else emptyState">
    <div class="card-grid">
      <mat-card
        class="equipment-card"
        *ngFor="let tipo of filtradoResumen; trackBy: trackByTipo"
      >
        <mat-card-header>
          <div mat-card-avatar class="equipment-avatar">
            {{ tipo.nombreTipoEquipo | slice: 0:1 }}
          </div>
          <mat-card-title>{{ tipo.nombreTipoEquipo }}</mat-card-title>
          <mat-card-subtitle>
            {{ tipo.totalCantidad }} {{ tipo.totalCantidad === 1 ? 'equipo' : 'equipos' }}
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <ul class="model-list">
            <li *ngFor="let modelo of tipo.modelos | slice: 0: maxModelosCompactos; trackBy: trackByModelo">
              <button
                type="button"
                class="model-item"
                (click)="verDetallePorModelo(tipo, modelo)"
              >
                <span class="model-name">
                  {{ modelo.nombreMarca }} · {{ modelo.nombreModelo }}
                </span>
                <span class="model-count">
                  {{ modelo.cantidad }}
                </span>
              </button>
            </li>
          </ul>
          <span class="preview-note" *ngIf="tipo.modelos.length > maxModelosCompactos">
            + {{ tipo.modelos.length - maxModelosCompactos }} modelo{{ tipo.modelos.length - maxModelosCompactos === 1 ? '' : 's' }} más
          </span>
        </mat-card-content>

        <mat-card-actions class="card-actions">
          <button mat-stroked-button color="primary" (click)="verDetallePorTipo(tipo)">
            Ver equipos
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </ng-container>

  <ng-template #emptyState>
    <div class="empty-state">
      <mat-icon>inventory_2</mat-icon>
      <p>No hay equipos registrados en el inventario.</p>
    </div>
  </ng-template>

  <app-modal-base
    [open]="modalTipoOpen"
    title="Registrar nuevo tipo"
    [disableClose]="formTipo.cargando"
    [useDefaultFooter]="false"
    [loading]="formTipo.cargando"
    (closed)="onModalTipoClosed()"
  >
    <div modal-body class="dialogo-tipo-contenido">
      <p>Ingresa el nombre del nuevo tipo de equipo.</p>
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Nombre del tipo</mat-label>
        <input
          matInput
          [(ngModel)]="formTipo.nombre"
          (ngModelChange)="formTipo.nombre = normalizarEntrada($event)"
          maxlength="80"
        />
      </mat-form-field>
      <mat-divider></mat-divider>
      <p class="mt-3 mb-1">
        Por favor confirma que el nombre es correcto. Esta acción no podrá deshacerse.
      </p>
      <mat-checkbox [(ngModel)]="formTipo.confirmacion">
        Confirmo que el nombre es correcto
      </mat-checkbox>
      <div class="mensaje-error" *ngIf="formTipo.error">
        <mat-icon>error_outline</mat-icon>
        {{ formTipo.error }}
      </div>
      <div class="mensaje-exito" *ngIf="formTipo.exito">
        <mat-icon>check_circle</mat-icon>
        {{ formTipo.exito }}
      </div>
    </div>
    <div modal-footer class="d-flex justify-content-end gap-2">
      <button class="btn btn-outline-secondary" type="button" (click)="onModalTipoClosed()" [disabled]="formTipo.cargando">
        Cancelar
      </button>
      <button
        class="btn btn-primary d-inline-flex align-items-center gap-2"
        type="button"
        (click)="confirmarCrearTipo()"
        [disabled]="!formTipo.confirmacion || !formTipo.nombre || formTipo.cargando"
      >
        <span class="spinner-border spinner-border-sm" *ngIf="formTipo.cargando" role="status" aria-hidden="true"></span>
        <span>Crear</span>
      </button>
    </div>
  </app-modal-base>
</div>
