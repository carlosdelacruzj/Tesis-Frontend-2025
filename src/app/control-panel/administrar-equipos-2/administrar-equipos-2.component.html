<div class="dashboard-content">
  <div class="page-header">
    <div class="page-header-text">
      <h1>Inventario de equipos</h1>
      <p>Explora rápidamente los modelos disponibles agrupados por tipo y accede al detalle completo.</p>
    </div>

    <div class="filters">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Buscar</mat-label>
        <input
          matInput
          #buscador
          type="text"
          placeholder="Tipo, marca o modelo"
          (keyup)="onBuscar(buscador.value)"
        />
        <button
          mat-icon-button
          matSuffix
          aria-label="Limpiar búsqueda"
          *ngIf="filtroTexto"
          (click)="buscador.value = ''; onBuscar('')"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Categoría</mat-label>
        <mat-select [value]="categoriaSeleccionada" (selectionChange)="onSeleccionarCategoria($event.value)">
          <mat-option value="todas">Todas las categorías</mat-option>
          <mat-option *ngFor="let categoria of categoriasDisponibles" [value]="categoria">
            {{ categoria | titlecase }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <ng-container *ngIf="filtradoResumen.length; else emptyState">
    <div class="card-grid">
      <mat-card
        class="equipment-card"
        *ngFor="let tipo of filtradoResumen; trackBy: trackByTipo"
      >
        <mat-card-header>
          <div mat-card-avatar class="equipment-avatar">
            {{ tipo.nombreTipoEquipo | slice: 0:1 }}
          </div>
          <mat-card-title>{{ tipo.nombreTipoEquipo }}</mat-card-title>
          <mat-card-subtitle>
            {{ tipo.totalCantidad }} {{ tipo.totalCantidad === 1 ? 'equipo' : 'equipos' }}
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <ul class="model-list">
            <li *ngFor="let modelo of tipo.modelos | slice: 0: maxModelosCompactos; trackBy: trackByModelo">
              <button
                type="button"
                class="model-item"
                (click)="verDetallePorModelo(tipo, modelo)"
              >
                <span class="model-name">
                  {{ modelo.nombreMarca }} · {{ modelo.nombreModelo }}
                </span>
                <span class="model-count">
                  {{ modelo.cantidad }}
                </span>
              </button>
            </li>
          </ul>
          <span class="preview-note" *ngIf="tipo.modelos.length > maxModelosCompactos">
            + {{ tipo.modelos.length - maxModelosCompactos }} modelo{{ tipo.modelos.length - maxModelosCompactos === 1 ? '' : 's' }} más
          </span>
        </mat-card-content>

        <mat-card-actions class="card-actions">
          <button mat-stroked-button color="primary" (click)="verDetallePorTipo(tipo)">
            Ver equipos de este tipo
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </ng-container>

  <ng-template #emptyState>
    <div class="empty-state">
      <mat-icon>inventory_2</mat-icon>
      <p>No hay equipos registrados en el inventario.</p>
    </div>
  </ng-template>
</div>
