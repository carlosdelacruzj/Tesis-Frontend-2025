<div class="dashboard-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <mat-card class="card">
          <mat-card-header class="card-header">
            <mat-card-title>Asignar perfil a usuario</mat-card-title>
          </mat-card-header>

          <mat-card-content class="card-body">
            @if (error) {
              <div class="alert alert-danger" role="alert">{{ error }}</div>
            }

            <form #perfilForm="ngForm" (ngSubmit)="asignarPerfil(perfilForm)">
              <div class="form-row">
                <mat-form-field class="col-xl-4 col-lg-4 col-md-6 col-sm-12 col-12 mb-2" appearance="fill">
                  <mat-label>Buscar empleado</mat-label>
                  <input matInput type="text" name="empleadoBusqueda" [(ngModel)]="empleadoBusqueda"
                    (ngModelChange)="filtrarEmpleados()" placeholder="Nombre, correo o usuarioId"
                    [disabled]="loadingEmpleados">
                </mat-form-field>

                <mat-form-field class="col-xl-5 col-lg-6 col-md-6 col-sm-12 col-12 mb-2" appearance="fill">
                  <mat-label>Empleado</mat-label>
                  <mat-select name="usuarioId" [(ngModel)]="usuarioId" (selectionChange)="onEmpleadoChange($event.value)"
                    required [disabled]="loadingEmpleados">
                    @for (empleado of empleadosFiltrados; track empleado.idEmpleado) {
                      <mat-option [value]="empleado.idUsuario">
                        {{ empleado.nombreCompleto }} - {{ empleado.correo }} (usuarioId: {{ empleado.idUsuario }})
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>

                <mat-form-field class="col-xl-3 col-lg-12 col-md-12 col-sm-12 col-12 mb-2" appearance="fill">
                  <mat-label>Usuario ID</mat-label>
                  <input matInput type="number" [ngModel]="usuarioId" name="usuarioIdReadonly" readonly>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field class="col-xl-4 col-lg-4 col-md-6 col-sm-12 col-12 mb-2" appearance="fill">
                  <mat-label>Perfil</mat-label>
                  <mat-select name="perfilCodigo" [(ngModel)]="perfilCodigo" required [disabled]="loadingPerfiles">
                    @for (perfil of perfiles; track perfil.codigo) {
                      <mat-option [value]="perfil.codigo">
                        {{ perfil.codigo }} - {{ perfil.nombre }}
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>

                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 col-12 mb-2 d-flex align-items-center">
                  <mat-checkbox name="principal" [(ngModel)]="principal">Perfil principal</mat-checkbox>
                </div>
              </div>

              <button class="btn btn-primary mb-2 mr-1" type="submit" [disabled]="perfilForm.invalid || submitting || cargandoDatos">
                {{ submitting ? 'Guardando...' : 'Asignar' }}
              </button>
              <button class="btn btn-secondary mb-2 mr-1" type="button" [routerLink]="['/home/gestionar-perfiles']">
                Atras
              </button>
            </form>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>
