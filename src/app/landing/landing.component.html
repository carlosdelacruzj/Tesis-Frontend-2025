<div class="schema" [innerHTML]="localBusinessSchema"></div>
<div class="schema" [innerHTML]="faqSchema"></div>

<section>
  <header class="hero" id="inicio">
    <div class="hero__content">
      <p class="hero__eyebrow">Fotografía y video en Lima</p>
      <h1>Contamos tu historia con luz, sonido y emoción</h1>
      <p class="hero__subtitle">
        Producciones profesionales para bodas, eventos y marcas. Equipo senior
        especializado en storytelling visual.
      </p>
      <div class="hero__cta">
        <button
          class="btn btn-secondary"
          (click)="
            scrollToSection('cotizacion');
            trackEvent('cta_click', { source: 'hero-primary' })
          "
        >
          Pedir cotización
        </button>
        <a
          mat-stroked-button
          color="primary"
          href="https://wa.me/51931764349?text=Hola%20quiero%20una%20cotizaci%C3%B3n"
          target="_blank"
          rel="noopener"
          (click)="clickWhatsApp('hero')"
        >
          WhatsApp inmediato
        </a>
      </div>
      <!-- <ul class="hero__badges">
        @for (badge of heroBadges; track badge.label) {
          <li>
            <strong>{{ badge.label }}</strong>
            <span>{{ badge.caption }}</span>
          </li>
        }
      </ul> -->
    </div>
  </header>

  <section class="services" id="servicios">
    <div class="section__header">
      <h2>Servicios de fotografía y video</h2>
      <p>
        Paquetes flexibles para cubrir desde sesiones familiares hasta
        producciones corporativas complejas.
      </p>
    </div>
    <div class="services__grid">
      @for (service of services; track service.title) {
        <article class="service-card">
          <div class="service-card__body">
            <h3>{{ service.title }}</h3>
            <p>{{ service.description }}</p>
            <ul>
              @for (bullet of service.bullets; track $index) {
                <li>{{ bullet }}</li>
              }
            </ul>
          </div>
          <button
            mat-stroked-button
            color="primary"
            (click)="prefillService(service)"
          >
            Cotizar
          </button>
        </article>
      }
    </div>
  </section>

  <section class="portfolio" id="portafolio">
    <div class="section__header">
      <h2>Portafolio reciente</h2>
      <p>
        Selecciona una categoría y revisa sesiones reales en Lima y provincias.
      </p>
    </div>
    <!-- <div class="portfolio__summary">
      <div class="portfolio__counts">
        <div>
          <span class="portfolio__count">{{ portfolioTotalImages }}</span>
          <span class="portfolio__label">Proyectos</span>
        </div>
        <div>
          <span class="portfolio__count">{{ portfolioTotalCategories }}</span>
          <span class="portfolio__label">Categorias</span>
        </div>
      </div>
    </div> -->
    @if (portfolioLoading) {
      <p class="portfolio__status">Cargando portafolio...</p>
    } @else if (portfolioError) {
      <p class="portfolio__status">{{ portfolioError }}</p>
    } @else if (portfolioCategories.length === 0) {
      <p class="portfolio__status">Sin imagenes para mostrar.</p>
    } @else {
      <div class="portfolio__categories-wrap">
        <button
          type="button"
          class="portfolio__nav portfolio__nav--prev"
          (click)="scrollCategoryPrev()"
          [disabled]="!canScrollCategories || categoryAtStart"
        >
          <mat-icon>chevron_left</mat-icon>
        </button>
        <div class="portfolio__carousel">
          <div
            class="portfolio__categories"
            #categoryTrack
            (scroll)="onCategoryScroll()"
          >
            @for (category of carouselCategories; track category.name) {
              <button
                type="button"
                class="portfolio__category"
                [class.is-active]="selectedCategory === category.name"
                (click)="openCategory(category.name)"
              >
                <div class="portfolio__category-images">
                  @for (preview of category.preview; track preview.id) {
                    <img
                      [src]="preview.thumbnail"
                      [alt]="preview.title"
                      loading="lazy"
                    />
                  }
                </div>
                <div class="portfolio__category-meta">
                  <h3>{{ category.name }}</h3>
                  <span>{{ category.total }} imagenes</span>
                </div>
              </button>
            }
          </div>
        </div>
        <button
          type="button"
          class="portfolio__nav portfolio__nav--next"
          (click)="scrollCategoryNext()"
          [disabled]="!canScrollCategories || categoryAtEnd"
        >
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>

      @if (selectedCategory) {
        <div class="portfolio__gallery">
          <div class="portfolio__gallery-header">
            <div>
              <h3>{{ selectedCategory }}</h3>
              <p>{{ selectedCategoryItems.length }} imagenes disponibles</p>
            </div>
            <button
              type="button"
              class="portfolio__close"
              (click)="closeCategory()"
            >
              Cerrar
            </button>
          </div>
          <div class="portfolio__grid">
            @for (item of pagedCategoryItems; track item.id) {
              <article
                class="portfolio__item"
                (click)="openLightbox(item)"
                tabindex="0"
                (keydown.enter)="openLightbox(item)"
              >
                <img
                  class="portfolio__image"
                  [src]="item.thumbnail"
                  [alt]="item.title"
                  loading="lazy"
                />
                <div class="portfolio__overlay">
                  <span class="portfolio__type">{{ item.type }}</span>
                  <h3 class="portfolio__title">{{ item.title }}</h3>
                </div>
              </article>
            }
          </div>
          @if (galleryTotalPages > 1) {
            <div class="portfolio__pager">
              <button
                type="button"
                class="portfolio__pager-btn"
                (click)="prevGalleryPage()"
                [disabled]="galleryPage === 1"
              >
                Anterior
              </button>
              <span>Pagina {{ galleryPage }} de {{ galleryTotalPages }}</span>
              <button
                type="button"
                class="portfolio__pager-btn"
                (click)="nextGalleryPage()"
                [disabled]="galleryPage === galleryTotalPages"
              >
                Siguiente
              </button>
            </div>
          }
        </div>
      }
    }
  </section>

  @if (false) {
    <section class="packages" id="paquetes">
      <div class="section__header">
        <h2>Paquetes pensados para tu producción</h2>
        <p>Selecciona una base y agrega los complementos que necesites.</p>
      </div>
      <div class="packages__grid">
        @for (tier of packages; track tier.name) {
          <article class="package" [class.package--highlight]="tier.highlight">
            <h3>{{ tier.name }}</h3>
            <p class="package__price" aria-hidden="true"></p>
            <ul class="package__specs">
              <li>{{ tier.hours }}</li>
              <li>{{ tier.photos }}</li>
              <li>{{ tier.video }}</li>
              <li>{{ tier.delivery }}</li>
            </ul>
            <div class="package__addons">
              <h4>Add-ons disponibles</h4>
              <ul>
                @for (addon of tier.addons; track $index) {
                  <li>{{ addon }}</li>
                }
              </ul>
            </div>
            <p class="package__note">{{ tier.recommendedFor }}</p>
            <button
              mat-raised-button
              color="primary"
              (click)="prefillPackage(tier)"
            >
              Cotizar este paquete
            </button>
          </article>
        }
      </div>
    </section>
  }

  <section class="about" id="nosotros">
    <div class="about__media">
      <img
        src="assets/images/delacruz-owner.jpeg"
        alt="Edwin de la Cruz en cobertura audiovisual"
        loading="lazy"
      />
    </div>
    <div class="about__content">
      <h2>Sobre D' La Cruz</h2>
      <p>
        Somos un colectivo audiovisual con base en Lima. Producimos historias
        memorables combinando dirección cinematográfica, iluminación creativa y
        sonido profesional. Cada proyecto cuenta con un project manager dedicado
        para asegurar tiempos y calidad.
      </p>
      <ul>
        <li>
          Especialistas en bodas destino, campañas corporativas y experiencias
          inmersivas.
        </li>
        <li>
          Pipeline optimizado para entrega rápida en múltiples formatos
          (vertical, widescreen, reels).
        </li>
        <li>Equipo de post-producción in-house con estándar broadcast.</li>
      </ul>
      <button mat-stroked-button (click)="scrollToSection('cotizacion')">
        ¿Listo para cotizar?
      </button>
    </div>
  </section>

  <section class="cta-band" id="cta-final">
    <div class="cta-band__content">
      <h2>¿Listo para cotizar?</h2>
      <p>
        Conversemos hoy y recibe una propuesta personalizada con disponibilidad
        real de fechas.
      </p>
      <div class="cta-band__actions">
        <button
          mat-raised-button
          color="primary"
          (click)="scrollToSection('cotizacion')"
        >
          Pedir cotización
        </button>
        <a
          mat-stroked-button
          color="primary"
          href="https://wa.me/51931764349?text=Hola%20quiero%20una%20cotizaci%C3%B3n"
          target="_blank"
          rel="noopener"
          (click)="clickWhatsApp('cta-band')"
        >
          WhatsApp
        </a>
      </div>
    </div>
  </section>

  <section class="quote" id="cotizacion">
    <div class="section__header">
      <h2>Solicita tu propuesta</h2>
      <p>
        Completa los datos esenciales y te contactamos por WhatsApp en menos de
        2 horas.
      </p>
    </div>

    <div class="quote__card">
      <form
        class="quote__form"
        [formGroup]="quoteForm"
        (ngSubmit)="submitQuote()"
        novalidate
      >
        <div class="quote__grid" (focusin)="handleQuoteStart()">
          <div class="form-group">
            <label class="form-label" for="quoteNombreCompleto"
              >Nombre completo</label
            >
            <input
              id="quoteNombreCompleto"
              type="text"
              class="form-control"
              formControlName="nombreCompleto"
              autocomplete="name"
              required
              [class.is-invalid]="
                quoteForm.get('nombreCompleto')?.invalid &&
                (quoteForm.get('nombreCompleto')?.dirty ||
                  quoteForm.get('nombreCompleto')?.touched)
              "
            />
            @if (
              quoteForm.get("nombreCompleto")?.invalid &&
              (quoteForm.get("nombreCompleto")?.dirty ||
                quoteForm.get("nombreCompleto")?.touched)
            ) {
              <div class="invalid-feedback d-block">
                @if (quoteForm.get("nombreCompleto")?.errors?.required) {
                  <span>Campo requerido</span>
                }
                @if (quoteForm.get("nombreCompleto")?.errors?.minlength) {
                  <span>Mínimo 3 caracteres</span>
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label class="form-label" for="quoteWhatsapp"
              >Número WhatsApp</label
            >
            <input
              id="quoteWhatsapp"
              type="text"
              class="form-control"
              formControlName="whatsappNumero"
              autocomplete="tel"
              placeholder="999999999"
              required
              inputmode="tel"
              [class.is-invalid]="
                quoteForm.get('whatsappNumero')?.invalid &&
                (quoteForm.get('whatsappNumero')?.dirty ||
                  quoteForm.get('whatsappNumero')?.touched)
              "
            />
            @if (
              quoteForm.get("whatsappNumero")?.invalid &&
              (quoteForm.get("whatsappNumero")?.dirty ||
                quoteForm.get("whatsappNumero")?.touched)
            ) {
              <div class="invalid-feedback d-block">
                @if (quoteForm.get("whatsappNumero")?.errors?.required) {
                  <span>Campo requerido</span>
                }
                @if (quoteForm.get("whatsappNumero")?.errors?.pattern) {
                  <span>Usa solo dígitos (6-15)</span>
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label class="form-label" for="quoteTipoEvento"
              >Tipo de evento</label
            >
            <select
              id="quoteTipoEvento"
              class="form-control"
              formControlName="tipoEvento"
              required
              (change)="onEventSelectionChange($any($event.target).value)"
              [class.is-invalid]="
                quoteForm.get('tipoEvento')?.invalid &&
                (quoteForm.get('tipoEvento')?.dirty ||
                  quoteForm.get('tipoEvento')?.touched)
              "
            >
              <option value="">Selecciona un evento</option>
              @for (event of eventOptions; track event.name) {
                <option [value]="event.name">{{ event.name }}</option>
              }
            </select>
            @if (
              quoteForm.get("tipoEvento")?.invalid &&
              (quoteForm.get("tipoEvento")?.dirty ||
                quoteForm.get("tipoEvento")?.touched)
            ) {
              <div class="invalid-feedback d-block">
                <span>Selecciona un evento</span>
              </div>
            }
          </div>

          <div class="form-group">
            <label class="form-label" for="quoteFechaEvento"
              >Fecha del evento</label
            >
            <input
              id="quoteFechaEvento"
              type="date"
              class="form-control"
              formControlName="fechaEvento"
              [attr.min]="minQuoteDate | date: 'yyyy-MM-dd'"
              [attr.max]="maxQuoteDate | date: 'yyyy-MM-dd'"
              required
              [class.is-invalid]="
                quoteForm.get('fechaEvento')?.invalid &&
                (quoteForm.get('fechaEvento')?.dirty ||
                  quoteForm.get('fechaEvento')?.touched)
              "
            />
            @if (
              quoteForm.get("fechaEvento")?.invalid &&
              (quoteForm.get("fechaEvento")?.dirty ||
                quoteForm.get("fechaEvento")?.touched)
            ) {
              <div class="invalid-feedback d-block">
                @if (quoteForm.get("fechaEvento")?.errors?.required) {
                  <span>Selecciona la fecha</span>
                }
                @if (quoteForm.get("fechaEvento")?.errors?.fechaMin) {
                  <span>No podemos usar una fecha pasada</span>
                }
                @if (quoteForm.get("fechaEvento")?.errors?.fechaMax) {
                  <span>Elige una fecha dentro de los próximos 6 meses</span>
                }
                @if (quoteForm.get("fechaEvento")?.errors?.fechaFormato) {
                  <span>Ingresa una fecha válida</span>
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label class="form-label" for="quoteDias">Cantidad de días</label>
            <input
              id="quoteDias"
              type="number"
              class="form-control"
              formControlName="dias"
              placeholder="Ej. 2"
              required
              min="1"
              step="1"
              inputmode="numeric"
              [class.is-invalid]="
                quoteForm.get('dias')?.invalid &&
                (quoteForm.get('dias')?.dirty || quoteForm.get('dias')?.touched)
              "
            />
            @if (
              quoteForm.get("dias")?.invalid &&
              (quoteForm.get("dias")?.dirty || quoteForm.get("dias")?.touched)
            ) {
              <div class="invalid-feedback d-block">
                @if (quoteForm.get("dias")?.errors?.required) {
                  <span>Indica cuántos días dura el evento</span>
                }
                @if (quoteForm.get("dias")?.errors?.pattern) {
                  <span>Ingresa un número válido</span>
                }
                @if (quoteForm.get("dias")?.errors?.min) {
                  <span>El mínimo es 1 día</span>
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label class="form-label" for="quoteHoras"
              >Horas estimadas por día</label
            >
            <input
              id="quoteHoras"
              type="number"
              class="form-control"
              formControlName="horas"
              placeholder="Ej. 6"
              required
              inputmode="decimal"
              min="1"
              step="0.5"
              [class.is-invalid]="
                quoteForm.get('horas')?.invalid &&
                (quoteForm.get('horas')?.dirty ||
                  quoteForm.get('horas')?.touched)
              "
            />
            @if (
              quoteForm.get("horas")?.invalid &&
              (quoteForm.get("horas")?.dirty || quoteForm.get("horas")?.touched)
            ) {
              <div class="invalid-feedback d-block">
                @if (quoteForm.get("horas")?.errors?.required) {
                  <span>Indica cuántas horas por día necesitas</span>
                }
                @if (quoteForm.get("horas")?.errors?.horasFormato) {
                  <span>Ingresa un número válido (ej. 1, 1.5, 2)</span>
                }
                @if (quoteForm.get("horas")?.errors?.horasMin) {
                  <span>El mínimo es 1 hora</span>
                }
                @if (quoteForm.get("horas")?.errors?.horasStep) {
                  <span>Usa incrementos de 0.5 horas (1.0, 1.5, 2.0…)</span>
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label class="form-label" for="quoteDepartamento"
              >Departamento</label
            >
            <select
              id="quoteDepartamento"
              class="form-control"
              formControlName="departamento"
              required
              [class.is-invalid]="
                quoteForm.get('departamento')?.invalid &&
                (quoteForm.get('departamento')?.dirty ||
                  quoteForm.get('departamento')?.touched)
              "
            >
              <option value="">Selecciona un departamento</option>
              @for (dep of departamentos; track dep) {
                <option [value]="dep">{{ dep }}</option>
              }
            </select>
            @if (
              quoteForm.get("departamento")?.invalid &&
              (quoteForm.get("departamento")?.dirty ||
                quoteForm.get("departamento")?.touched)
            ) {
              <div class="invalid-feedback d-block">
                <span>Selecciona un departamento</span>
              </div>
            }
          </div>

          <div class="form-group quote__span">
            <label class="form-label" for="quoteMensaje"
              >Mensaje (opcional)</label
            >
            <textarea
              id="quoteMensaje"
              class="form-control"
              rows="3"
              formControlName="mensaje"
              placeholder="¿Qué idea tienes en mente?"
            ></textarea>
          </div>
        </div>

        <mat-expansion-panel class="quote__panel">
          <mat-expansion-panel-header>
            <mat-panel-title>Información opcional</mat-panel-title>
            <mat-panel-description
              >Ayuda a personalizar tu propuesta (1 minuto
              extra)</mat-panel-description
            >
          </mat-expansion-panel-header>

          <div class="quote__grid">
            <div class="form-group">
              <label class="form-label" for="quoteInvitados"
                >N° aproximado de invitados</label
              >
              <input
                id="quoteInvitados"
                type="text"
                class="form-control"
                formControlName="invitados"
                placeholder="Ej. 120"
              />
            </div>
          </div>

          <div class="quote__extras">
            <p>Extras populares</p>
            <div class="quote__extras-grid" formGroupName="extras">
              @for (extra of extrasCatalog; track extra.control) {
                <div class="form-check quote__extra-card">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [id]="'extra-' + extra.control"
                    [formControlName]="extra.control"
                  />
                  <label
                    class="form-check-label extra-text"
                    [for]="'extra-' + extra.control"
                  >
                    <strong>{{ extra.label }}</strong>
                    <span>{{ extra.description }}</span>
                  </label>
                </div>
              }
            </div>
          </div>

          <div class="form-group quote__select">
            <label class="form-label" for="quoteOrigen"
              >¿Cómo nos encontraste?</label
            >
            <select
              id="quoteOrigen"
              class="form-control"
              formControlName="comoNosConociste"
            >
              <option value="">Selecciona una opción</option>
              @for (option of sourceOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>
        </mat-expansion-panel>

        <div class="form-check quote__consent">
          <input
            class="form-check-input"
            type="checkbox"
            id="quoteConsentimiento"
            formControlName="consentimiento"
            [class.is-invalid]="
              quoteForm.get('consentimiento')?.invalid &&
              (quoteForm.get('consentimiento')?.dirty ||
                quoteForm.get('consentimiento')?.touched)
            "
          />
          <label class="form-check-label" for="quoteConsentimiento">
            Acepto el uso de mis datos para recibir propuestas de D' La Cruz y
            confirmo haber leído la política de privacidad.
          </label>
          @if (
            quoteForm.get("consentimiento")?.invalid &&
            (quoteForm.get("consentimiento")?.dirty ||
              quoteForm.get("consentimiento")?.touched)
          ) {
            <div class="invalid-feedback d-block">
              Debes aceptar para continuar.
            </div>
          }
        </div>

        <div class="quote__actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="isSubmitting || !eventCatalogReady"
          >
            {{ isSubmitting ? "Enviando…" : "Enviar solicitud" }}
          </button>
          @if (whatsAppLink) {
            <a
              mat-stroked-button
              color="primary"
              [href]="whatsAppLink"
              target="_blank"
              rel="noopener"
              (click)="clickWhatsApp('form-success')"
            >
              Continuar en WhatsApp
            </a>
          }
        </div>

        @if (submissionSuccess) {
          <div class="quote__feedback">
            <p>
              ¡Gracias! Tu solicitud fue enviada. También puedes continuar la
              conversación por WhatsApp.
            </p>
          </div>
        }
      </form>
    </div>
  </section>

  <section class="faq" id="faq">
    <div class="section__header">
      <h2>Preguntas frecuentes</h2>
      <p>Todo lo que necesitas saber antes de reservar.</p>
    </div>
    <mat-accordion class="faq__accordion">
      @for (faq of faqs; track faq.question) {
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>{{ faq.question }}</mat-panel-title>
          </mat-expansion-panel-header>
          <p>{{ faq.answer }}</p>
        </mat-expansion-panel>
      }
    </mat-accordion>
  </section>

  <footer class="landing__footer">
    <div>
      <strong>D' La Cruz video y fotografía © {{ currentYear }}</strong>
      <p>Producciones audiovisuales en Lima y todo el Perú.</p>
    </div>
    <div class="landing__footer-links">
      <a href="mailto:hola&#64;dlacruz.com">hola&#64;dlacruz.com</a>
      <a href="tel:+51999999999">+51 999 999 999</a>
      <a href="#cotizacion">Política de privacidad</a>
    </div>
  </footer>
</section>

<div class="floating-cta">
  <button
    mat-raised-button
    color="primary"
    (click)="
      scrollToSection('cotizacion');
      trackEvent('cta_click', { source: 'floating' })
    "
  >
    Pedir cotización
  </button>
  <a
    mat-mini-fab
    color="primary"
    href="https://wa.me/51931764349?text=Hola%20quiero%20una%20cotizaci%C3%B3n"
    target="_blank"
    rel="noopener"
    aria-label="WhatsApp"
    (click)="clickWhatsApp('floating')"
  >
    <mat-icon>chat</mat-icon>
  </a>
</div>

@if (selectedLightboxItem) {
  <div
    class="lightbox"
    role="button"
    tabindex="0"
    (click)="closeLightbox()"
    (keydown.enter)="closeLightbox()"
    (keydown.space)="closeLightbox()"
  >
    <div
      class="lightbox__content"
      tabindex="0"
      (click)="$event.stopPropagation()"
      (keydown.enter)="$event.stopPropagation()"
      (keydown.space)="$event.stopPropagation()"
    >
      <button
        class="lightbox__close"
        type="button"
        (click)="closeLightbox()"
        aria-label="Cerrar"
      >
        <mat-icon>close</mat-icon>
      </button>
      @switch (selectedLightboxItem.mediaType) {
        @case ("image") {
          <img
            [src]="selectedLightboxItem.source"
            [alt]="selectedLightboxItem.title"
            loading="lazy"
          />
        }
        @case ("video") {
          <video
            controls
            autoplay
            playsinline
            [poster]="selectedLightboxItem.poster"
            muted
          >
            <source [src]="selectedLightboxItem.source" type="video/mp4" />
          </video>
        }
      }
      <h3>{{ selectedLightboxItem?.title }}</h3>
      <p>{{ selectedLightboxItem?.type }}</p>
    </div>
  </div>
}
