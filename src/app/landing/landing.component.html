<div class="schema" [innerHTML]="localBusinessSchema"></div>
<div class="schema" [innerHTML]="faqSchema"></div>

<section>
  <header class="hero" id="inicio">
    <div class="hero__content">
      <p class="hero__eyebrow">Fotografía y video en Lima</p>
      <h1>Contamos tu historia con luz, sonido y emoción</h1>
      <p class="hero__subtitle">
        Producciones profesionales para bodas, eventos y marcas. Equipo senior especializado en storytelling visual.
      </p>
      <div class="hero__cta">
        <button mat-raised-button color="primary"
          (click)="scrollToSection('cotizacion'); trackEvent('cta_click', { source: 'hero-primary' });">
          Pedir cotización
        </button>
        <a mat-stroked-button color="primary"
          href="https://wa.me/51931764349?text=Hola%20quiero%20una%20cotizaci%C3%B3n" target="_blank" rel="noopener"
          (click)="clickWhatsApp('hero')">
          WhatsApp inmediato
        </a>
      </div>
      <ul class="hero__badges">
        @for (badge of heroBadges; track badge.label) {
          <li>
            <strong>{{ badge.label }}</strong>
            <span>{{ badge.caption }}</span>
          </li>
        }
      </ul>
    </div>
  </header>

  <section class="services" id="servicios">
    <div class="section__header">
      <h2>Servicios de fotografía y video</h2>
      <p>Paquetes flexibles para cubrir desde sesiones familiares hasta producciones corporativas complejas.</p>
    </div>
    <div class="services__grid">
      @for (service of services; track service.title) {
        <article class="service-card">
          <div class="service-card__body">
            <h3>{{ service.title }}</h3>
            <p>{{ service.description }}</p>
            <ul>
              @for (bullet of service.bullets; track $index) {
                <li>{{ bullet }}</li>
              }
            </ul>
          </div>
          <button mat-stroked-button color="primary" (click)="prefillService(service)">Cotizar</button>
        </article>
      }
    </div>
  </section>

  <section class="portfolio" id="portafolio">
    <div class="section__header">
      <h2>Portafolio reciente</h2>
      <p>Selecciona una categoría y revisa sesiones reales en Lima y provincias.</p>
    </div>
    <div class="portfolio__filters">
      @for (filter of portfolioFilters; track filter) {
        <button
          mat-button
          [color]="activePortfolioFilter === filter ? 'primary' : undefined"
          (click)="setPortfolioFilter(filter)">
          {{ filter }}
        </button>
      }
    </div>
    <div class="portfolio__grid">
      @for (item of filteredPortfolio; track item.title) {
        <article class="portfolio__item" (click)="openLightbox(item)" tabindex="0" (keydown.enter)="openLightbox(item)">
          <img [src]="item.thumbnail" [alt]="item.title" loading="lazy" />
          <div class="portfolio__overlay">
            <span class="portfolio__type">{{ item.type }}</span>
            <h3>{{ item.title }}</h3>
          </div>
        </article>
      }
    </div>
  </section>

  <section class="packages" id="paquetes">
    <div class="section__header">
      <h2>Paquetes pensados para tu producción</h2>
      <p>Selecciona una base y agrega los complementos que necesites.</p>
    </div>
    <div class="packages__grid">
      @for (tier of packages; track tier.name) {
        <article class="package" [class.package--highlight]="tier.highlight">
          <h3>{{ tier.name }}</h3>
          <p class="package__price" aria-hidden="true"></p>
          <ul class="package__specs">
            <li>{{ tier.hours }}</li>
            <li>{{ tier.photos }}</li>
            <li>{{ tier.video }}</li>
            <li>{{ tier.delivery }}</li>
          </ul>
          <div class="package__addons">
            <h4>Add-ons disponibles</h4>
            <ul>
              @for (addon of tier.addons; track $index) {
                <li>{{ addon }}</li>
              }
            </ul>
          </div>
          <p class="package__note">{{ tier.recommendedFor }}</p>
          <button mat-raised-button color="primary" (click)="prefillPackage(tier)">Cotizar este paquete</button>
        </article>
      }
    </div>
  </section>

  <section class="about" id="nosotros">
    <div class="about__media">
      <img src="assets/images/delacruz-owner.jpeg" alt="Edwin de la Cruz en cobertura audiovisual" loading="lazy" />
    </div>
    <div class="about__content">
      <h2>Sobre D' La Cruz</h2>
      <p>
        Somos un colectivo audiovisual con base en Lima. Producimos historias memorables combinando dirección
        cinematográfica, iluminación creativa y sonido profesional. Cada proyecto cuenta con un project manager dedicado
        para asegurar tiempos y calidad.
      </p>
      <ul>
        <li>Especialistas en bodas destino, campañas corporativas y experiencias inmersivas.</li>
        <li>Pipeline optimizado para entrega rápida en múltiples formatos (vertical, widescreen, reels).</li>
        <li>Equipo de post-producción in-house con estándar broadcast.</li>
      </ul>
      <button mat-stroked-button (click)="scrollToSection('cotizacion')">¿Listo para cotizar?</button>
    </div>
  </section>

  <section class="cta-band" id="cta-final">
    <div class="cta-band__content">
      <h2>¿Listo para cotizar?</h2>
      <p>Conversemos hoy y recibe una propuesta personalizada con disponibilidad real de fechas.</p>
      <div class="cta-band__actions">
        <button mat-raised-button color="primary" (click)="scrollToSection('cotizacion')">Pedir cotización</button>
        <a mat-stroked-button color="primary"
          href="https://wa.me/51931764349?text=Hola%20quiero%20una%20cotizaci%C3%B3n" target="_blank" rel="noopener"
          (click)="clickWhatsApp('cta-band')">
          WhatsApp
        </a>
      </div>
    </div>
  </section>

  <section class="quote" id="cotizacion">
    <div class="section__header">
      <h2>Solicita tu propuesta</h2>
      <p>Completa los datos esenciales y te contactamos por WhatsApp en menos de 2 horas.</p>
    </div>

    <div class="quote__card">
      <form class="quote__form" [formGroup]="quoteForm" (ngSubmit)="submitQuote()" novalidate>
        <div class="quote__grid" (focusin)="handleQuoteStart()">
          <mat-form-field appearance="outline">
            <mat-label>Nombre completo</mat-label>
            <input matInput formControlName="nombreCompleto" autocomplete="name" required />
            @if (quoteForm.get('nombreCompleto')?.hasError('required')) {
              <mat-error>El nombre es obligatorio.</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Número WhatsApp</mat-label>
            <input matInput formControlName="whatsappNumero" autocomplete="tel" placeholder="999999999" required
              inputmode="tel" />
            @if (quoteForm.get('whatsappNumero')?.hasError('required')) {
              <mat-error>Ingresa tu número.</mat-error>
            }
            @if (quoteForm.get('whatsappNumero')?.hasError('pattern')) {
              <mat-error>Usa solo dígitos (6-15).</mat-error>
            }
            <mat-hint>Ingresa solo números, sin prefijos.</mat-hint>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Tipo de evento</mat-label>
            <mat-select formControlName="tipoEvento" required (selectionChange)="onEventSelectionChange($event.value)">
              <mat-option value="">Selecciona un evento</mat-option>
              @for (event of eventOptions; track event.name) {
                <mat-option [value]="event.name">{{ event.name }}</mat-option>
              }
            </mat-select>
            @if (quoteForm.get('tipoEvento')?.hasError('required')) {
              <mat-error>Selecciona un evento.</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Fecha del evento</mat-label>
            <input matInput [matDatepicker]="quoteEventPicker" formControlName="fechaEvento" [min]="minQuoteDate"
              [max]="maxQuoteDate" required (keydown)="$event.preventDefault()"
              (focus)="quoteEventPicker.open()" readonly />
            <mat-datepicker-toggle matSuffix [for]="quoteEventPicker"></mat-datepicker-toggle>
            <mat-datepicker #quoteEventPicker></mat-datepicker>
            @if (quoteForm.get('fechaEvento')?.hasError('required')) {
              <mat-error>Selecciona la fecha.</mat-error>
            }
            @if (quoteForm.get('fechaEvento')?.hasError('matDatepickerMin')) {
              <mat-error>No podemos usar una fecha pasada.</mat-error>
            }
            @if (quoteForm.get('fechaEvento')?.hasError('matDatepickerMax')) {
              <mat-error>Elige una fecha dentro de los próximos 6 meses.</mat-error>
            }
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>duración estimada</mat-label>
            <input
              matInput
              type="number"
              formControlName="horas"
              placeholder="Ej. 6"
              required
              inputmode="decimal"
              min="1"
              step="0.5"
            />
            @if (quoteForm.get('horas')?.hasError('required')) {
              <mat-error>Indica cuántas horas necesitas.</mat-error>
            }
            @if (quoteForm.get('horas')?.hasError('horasFormato')) {
              <mat-error>Ingresa un número válido (ej. 1, 1.5, 2).</mat-error>
            }
            @if (quoteForm.get('horas')?.hasError('horasMin')) {
              <mat-error>El mínimo es 1 hora.</mat-error>
            }
            @if (quoteForm.get('horas')?.hasError('horasStep')) {
              <mat-error>Usa incrementos de 0.5 horas (1.0, 1.5, 2.0…).</mat-error>
            }
          </mat-form-field>



          <mat-form-field appearance="outline">
            <mat-label>Distrito o lugar</mat-label>
            <input matInput formControlName="distrito" placeholder="Ej. Miraflores, Pachacámac" required />
            @if (quoteForm.get('distrito')?.hasError('required')) {
              <mat-error>Indica el lugar.</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="quote__span">
            <mat-label>Mensaje (opcional)</mat-label>
            <textarea matInput rows="3" formControlName="mensaje" placeholder="¿Qué idea tienes en mente?"></textarea>
          </mat-form-field>
        </div>

        <mat-expansion-panel class="quote__panel">
          <mat-expansion-panel-header>
            <mat-panel-title>Información opcional</mat-panel-title>
            <mat-panel-description>Ayuda a personalizar tu propuesta (1 minuto extra)</mat-panel-description>
          </mat-expansion-panel-header>

          <div class="quote__grid">
            <mat-form-field appearance="outline">
              <mat-label>N° aproximado de invitados</mat-label>
              <input matInput formControlName="invitados" placeholder="Ej. 120" />
            </mat-form-field>


          </div>

          <div class="quote__extras">
            <p>Extras populares</p>
            <div class="quote__extras-grid" formGroupName="extras">
              @for (extra of extrasCatalog; track extra.control) {
                <mat-checkbox [formControlName]="extra.control">
                  <span class="extra-text">
                    <strong>{{ extra.label }}</strong>
                    <span>{{ extra.description }}</span>
                  </span>
                </mat-checkbox>
              }
            </div>
          </div>

          <mat-form-field appearance="outline" class="quote__select">
            <mat-label>¿Cómo nos encontraste?</mat-label>
            <mat-select formControlName="comoNosConociste">
              <mat-option value="">Selecciona una opción</mat-option>
              @for (option of sourceOptions; track option) {
                <mat-option [value]="option">{{ option }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </mat-expansion-panel>

        <mat-checkbox formControlName="consentimiento" class="quote__consent">
          Acepto el uso de mis datos para recibir propuestas de D' La Cruz y confirmo haber leído la política de
          privacidad.
        </mat-checkbox>

        <div class="quote__actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting">
            {{ isSubmitting ? 'Enviando…' : 'Enviar solicitud' }}
          </button>
          @if (whatsAppLink) {
            <a mat-stroked-button color="primary" [href]="whatsAppLink" target="_blank"
              rel="noopener" (click)="clickWhatsApp('form-success')">
              Continuar en WhatsApp
            </a>
          }
        </div>

        @if (submissionSuccess) {
          <div class="quote__feedback">
            <p>¡Gracias! Tu solicitud fue enviada. También puedes continuar la conversación por WhatsApp.</p>
          </div>
        }
      </form>
    </div>
  </section>

  <section class="faq" id="faq">
    <div class="section__header">
      <h2>Preguntas frecuentes</h2>
      <p>Todo lo que necesitas saber antes de reservar.</p>
    </div>
    <mat-accordion class="faq__accordion">
      @for (faq of faqs; track faq.question) {
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>{{ faq.question }}</mat-panel-title>
          </mat-expansion-panel-header>
          <p>{{ faq.answer }}</p>
        </mat-expansion-panel>
      }
    </mat-accordion>
  </section>

  <footer class="landing__footer">
    <div>
      <strong>D' La Cruz video y fotografía © {{ currentYear }}</strong>
      <p>Producciones audiovisuales en Lima y todo el Perú.</p>
    </div>
    <div class="landing__footer-links">
      <a href="mailto:hola&#64;dlacruz.com">hola&#64;dlacruz.com</a>
      <a href="tel:+51999999999">+51 999 999 999</a>
      <a href="#cotizacion">Política de privacidad</a>
    </div>
  </footer>
</section>

<div class="floating-cta">
  <button mat-raised-button color="primary"
    (click)="scrollToSection('cotizacion'); trackEvent('cta_click', { source: 'floating' });">
    Pedir cotización
  </button>
  <a mat-mini-fab color="primary" href="https://wa.me/51931764349?text=Hola%20quiero%20una%20cotizaci%C3%B3n"
    target="_blank" rel="noopener" aria-label="WhatsApp" (click)="clickWhatsApp('floating')">
    <mat-icon>chat</mat-icon>
  </a>
</div>

@if (selectedLightboxItem) {
  <div
    class="lightbox"
    role="button"
    tabindex="0"
    (click)="closeLightbox()"
    (keydown.enter)="closeLightbox()"
    (keydown.space)="closeLightbox()">
    <div
      class="lightbox__content"
      tabindex="0"
      (click)="$event.stopPropagation()"
      (keydown.enter)="$event.stopPropagation()"
      (keydown.space)="$event.stopPropagation()">
      <button class="lightbox__close" type="button" (click)="closeLightbox()" aria-label="Cerrar">
        <mat-icon>close</mat-icon>
      </button>
      @switch (selectedLightboxItem.mediaType) {
        @case ('image') {
          <img [src]="selectedLightboxItem.source" [alt]="selectedLightboxItem.title" loading="lazy" />
        }
        @case ('video') {
          <video controls autoplay playsinline [poster]="selectedLightboxItem.poster" muted>
            <source [src]="selectedLightboxItem.source" type="video/mp4" />
          </video>
        }
      }
      <h3>{{ selectedLightboxItem?.title }}</h3>
      <p>{{ selectedLightboxItem?.type }}</p>
    </div>
  </div>
}
